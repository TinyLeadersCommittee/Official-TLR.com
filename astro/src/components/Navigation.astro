---
// src/components/Navigation.astro

// 1. Get current path
const pathname = new URL(Astro.request.url).pathname;

// 2. Define logic for which section is active
const isRules = pathname.startsWith('/rules');
const isAbout = pathname.startsWith('/about');
const isCommunity = pathname.startsWith('/community');
const isBanlist = pathname.startsWith('/banlist');
const isDiscover = pathname.startsWith('/discover');
const isDesign = pathname.startsWith('/design');
const isFeed = pathname.startsWith('/feed');
---

<header class="context-header">
  <nav class="breadcrumb-nav">
    <a href="/">Home</a>
    
    {/* Discover Link (Always show unless we are on Home or Discover) */}
    {!isDiscover && pathname !== '/' && (
      <>
        <span class="sep">/</span>
        <a href="/discover">Discover</a>
      </>
    )}

    {/* RULES WING (Overview | Supplements) */}
    {isRules && (
      <>
        <span class="sep">/</span>
        <div class="wing-toggle">
          <a href="/rules/overview" class={!pathname.includes('/supplements') ? "active-wing" : ""}>Rules</a>
          <span class="pipe">|</span>
          <a href="/rules/supplements" class={pathname.includes('/supplements') ? "active-wing" : ""}>Supplements</a>
        </div>
      </>
    )}

    {/* BANLIST WING */}
    {isBanlist && (
      <>
        <span class="sep">/</span>
        <a href="/banlist" class="active-wing">Banlist</a>
      </>
    )}

    {/* DESIGN WING */}
    {isDesign && (
      <>
        <span class="sep">/</span>
        <a href="/design" class="active-wing">Design</a>
      </>
    )}

    {/* FEED WING */}
    {isFeed && (
      <>
        <span class="sep">/</span>
        <a href="/feed" class="active-wing">The Feed</a>
      </>
    )}

    {/* ABOUT WING (About | Committee) */}
    {isAbout && (
      <>
        <span class="sep">/</span>
        <div class="wing-toggle">
          <a href="/about" class={!pathname.includes('/committee') ? "active-wing" : ""}>About</a>
          <span class="pipe">|</span>
          <a href="/about/committee" class={pathname.includes('/committee') ? "active-wing" : ""}>Committee</a>
        </div>
      </>
    )}

    {/* COMMUNITY WING (Community | Little League | Paper Play | More Ways to Play) - NEW! */}
    {isCommunity && (
      <>
        <span class="sep">/</span>
        <div class="wing-toggle">
          {/* Active ONLY if we are at the root '/community' or '/community/' */}
          <a href="/community" 
          class={pathname === '/community' || pathname === '/community/' || pathname === '/community/index.astro' ? "active-wing" : ""}>Community</a>
          <span class="pipe">|</span>
          {/* Active if IS little-league */}
          <a href="/community/little-league" class={pathname.includes('/little-league') ? "active-wing" : ""}>Little League</a>
          <span class="pipe">|</span>
          {/* Active if IS paper-play */}
          <a href="/community/paper-play" class={pathname.includes('/paper-play') ? "active-wing" : ""}>Paper Play</a>
          <span class="pipe">|</span>
          {/* Active if IS play-options */}
          <a href="/community/play-options" class={pathname.includes('/play-options') ? "active-wing" : ""}>More Ways to Play</a>
          <span class="pipe">|</span>
          {/* Active if IS resources */}
          <a href="/community/resources" class={pathname.includes('/resources') ? "active-wing" : ""}>Resources</a>
        </div>
      </>
    )}
  </nav>
</header>

<style>
  /* SMART HEADER STYLING */
  .context-header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    padding: 1.5rem 2rem;
    background: linear-gradient(to bottom, var(--bg) 60%, transparent);
    z-index: 500; /* Below the sidebar trigger */
  }

  .breadcrumb-nav {
    font-family: 'Montserrat', sans-serif;
    font-size: 0.85rem;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 1px;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .breadcrumb-nav a {
    color: var(--text-body);
    opacity: 0.6;
    text-decoration: none;
  }

  .breadcrumb-nav a:hover {
    opacity: 1;
    color: var(--accent);
  }

  .breadcrumb-nav .active-wing {
    color: var(--accent);
    opacity: 1;
  }

  .sep {
    opacity: 0.3;
    font-weight: 300;
  }

  /* THE WING TOGGLE (The Container) */
  .wing-toggle {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    
    /* The Pill Look */
    background-color: var(--surface);
    border: 1px solid var(--border-subtle);
    padding: 0.25rem 1rem;
    border-radius: 50px; /* Fully rounded ends */
  }

  /* The Separator inside the toggle */
  .wing-toggle .pipe {
    color: var(--border-subtle);
    font-weight: 300;
  }

  /* The Active State inside the toggle */
  .wing-toggle .active-wing {
    color: var(--accent);
    font-weight: 800; /* Make it bold to stand out */
    opacity: 1;
  }
  
  /* Reset standard links inside the toggle to be subtle */
  .wing-toggle a:not(.active-wing) {
    font-weight: 400;
    opacity: 0.6;
  }

  /* Responsive Adjustments */
  @media (max-width: 600px) {
    .context-header { padding: 1rem; }
    .breadcrumb-nav { font-size: 0.7rem; gap: 0.5rem; }
  }
</style>