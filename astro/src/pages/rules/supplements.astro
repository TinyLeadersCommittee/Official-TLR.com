---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { Image } from 'astro:assets';
import grayImg from '../../assets/images/committee/consultants/gray.jpg';
import zimone from '../../assets/images/rules/zimone.jpg';

// Import Content Data
// CHANGED: We now import 'faqSections' instead of 'faqItems'
import { officialDocs, philosophyUpdate, faqSections, authorProfile } from '../../data/rules/supplementsData.js';
---

<BaseLayout title="Rules Supplements" 
bgImage={zimone}
bgBlur={true}
bgStyle="object-fit: contain; object-position: center;">
  
  <article class="rules-doc">
    
    <header class="page-header">
      <h1>Rules Supplements</h1>
      <p class="lead">
        These rules are indispensable whether you're a player, organizer, or judge.
      </p>
    </header>

    <hr class="divider" />

    <section id="documents" class="documents-section">
      <h2>Official Rules Documents</h2>
      <p>
        Select a document below to view it in your browser or download the PDF. 
        Please also review the FAQ below for common interactions.
      </p>
      
      <div class="doc-list">
        {officialDocs.map((doc) => (
          <div class="doc-row">
            <div class="doc-info">
              <strong>{doc.acronym}</strong> 
              <span class="doc-desc">({doc.title})</span>
            </div>
            <div class="doc-actions">
              <a href={doc.viewLink} class="action-link">View</a>
              <span class="separator">|</span>
              <a href={doc.downloadLink} target="_blank" class="action-link">Download</a>
            </div>
          </div>
        ))}
      </div>
    </section>

    <section id="philosophy" class="philosophy-section">
      
      <header class="philo-header-group">
         <h2>The Discrete Philosophy Update</h2>
         <div class="meta-date">Date: {philosophyUpdate.date}</div>
      </header>

      <div class="philo-content">
        {philosophyUpdate.blocks.map((block) => (
          <div class="philo-block">
            <h3>{block.title}</h3>
            <p>{block.text}</p>
            
            {/* Conditional Render: Bulleted List */}
            {block.list && (
              <ul class="tech-list">
                {block.list.map((item) => (
                  <li>{item}</li>
                ))}
              </ul>
            )}

            {/* Conditional Render: Ruling Text */}
            {block.ruling && (
              <p class="ruling-text" set:html={block.ruling.replace(/\n/g, '<br/>')} />
            )}
          </div>
        ))}
      </div>
    </section>
    
    <hr class="divider" />

    <section id="faq">
        <h2>Rules FAQ</h2>
        <p style="margin-bottom: 2rem; color: var(--text-muted);">Last updated: {philosophyUpdate.date}</p>
  
        <div class="faq-container">
          {faqSections.map((section) => (
            <div class="faq-group">
              <h3 class="faq-group-title">{section.header}</h3>
              <div class="faq-grid">
                {section.items.map((item) => (
                  <details>
                    <summary>{item.q}</summary>
                    <div class="faq-answer">
                      <p set:html={item.a} />
                    </div>
                  </details>
                ))}
              </div>
            </div>
          ))}
        </div>
    </section>

    <section class="author-section">
      <div class="unified-card">
        
        <h2>Author</h2>
        
        <div class="author-header-group">
            <div class="author-photo-wrapper">
                <Image src={grayImg} alt={authorProfile.name} width={160} height={160} class="author-photo" />
            </div>
            
            <div class="author-info-header">
                <div class="author-name">{authorProfile.name}</div>
                <div class="author-credentials">{authorProfile.credentials}</div>

                <svg class="scales-icon" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 3v18" />
                    <path d="M6 8h12" />
                    <path d="M6 21h12" />
                    <path d="M6 8v3a3 3 0 0 0 6 0v-3" transform="translate(-3 0)" />
                    <path d="M6 8v3a3 3 0 0 0 6 0v-3" transform="translate(9 0)" />
                </svg>
            </div>
        </div>
        
        <div class="author-body-text">
            {authorProfile.bio.map((paragraph) => (
              <p set:html={paragraph} />
            ))}
        </div>

        <div class="author-footer">
            <h3>Questions & Contributions</h3>
            <p>
              If you have questions regarding these documents or suggestions 
              for the FAQ, join us on the 
              <a href={authorProfile.discordLink}>Official TLR Discord</a>.
            </p>
            <ul class="contact-list">
              <li>
                <strong>General Rulings:</strong> Use the <code class="tag-code">#ask-a-certified-judge</code> channel.
              </li>
              <li>
                <strong>Policy Concerns:</strong> Message the Rules Manager, 
                <code class="tag-code">@{authorProfile.name} | Judge Dad | JF L2</code>.
              </li>
            </ul>
            <p class="contact-note">
              <em>A member of our Judge team will respond as soon as possible.</em>
            </p>
        </div>

      </div>
    </section>

  </article>
</BaseLayout>

<style>
  /* =========================================
     EXISTING STYLES (Preserved)
     ========================================= */
  .documents-section { margin-bottom: 3rem; }
  .documents-section h2 { margin-bottom: 0.5rem; }
  .documents-section p { margin-bottom: 1.5rem; color: var(--text-body); }

  .doc-list {
    display: flex;
    flex-direction: column;
    border-top: 1px solid var(--border-subtle);
    border-bottom: 1px solid var(--border-subtle);
  }

  .doc-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
    border-bottom: 1px solid var(--border-subtle);
  }
  .doc-row:last-child { border-bottom: none; }

  .doc-info { font-size: 1.1rem; color: var(--heading-color); }
  .doc-info strong { color: var(--accent); margin-right: 0.25rem; }
  .doc-desc { color: var(--text-body); font-size: 0.95rem; }

  .doc-actions {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.95rem;
    font-family: monospace;
  }

  .action-link {
    color: var(--heading-color);
    text-decoration: none;
    font-weight: bold;
    text-transform: uppercase;
    transition: color 0.2s;
  }
  .action-link:hover { color: var(--accent); text-decoration: underline; }
  .separator { color: var(--text-muted); opacity: 1; font-weight: 400; }

  /* Philosophy Sidebar */
  .philosophy-section {
    margin: 2rem auto; 
    max-width: 800px;
    border-left: 4px solid var(--accent); 
    padding: 2rem; 
  }

  .philo-header-group {
    margin-bottom: 2rem;
    border-bottom: 1px solid var(--border-subtle);
    padding-bottom: 1rem;
  }

  .philo-header-group h2 {
    margin: 0 0 0.5rem 0;
    font-size: 1.5rem;
    color: var(--heading-color);
  }

  .meta-date {
    font-family: monospace;
    font-size: 0.9rem;
    color: var(--text-body);
  }

  .philo-block { margin-bottom: 2.5rem; }
  
  .philo-block h3 {
    font-size: 1rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--accent);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
  }
  
  .philo-block h3::after {
    content: "";
    display: block;
    height: 1px;
    flex-grow: 1; 
    background: var(--border-subtle);
    opacity: 0.5;
  }

  .tech-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 1rem;
    list-style: none;
    padding: 0;
    margin: 1.5rem 0;
  }

  .tech-list li {
    background: var(--bg); 
    padding: 0.75rem;
    text-align: center;
    border-radius: 4px;
    font-weight: bold;
    font-size: 0.9rem;
    border: 1px solid var(--border-subtle);
    color: var(--heading-color);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .ruling-text {
    background: var(--bg);
    border-left: 3px solid var(--accent);
    padding: 1rem;
    margin-top: 1.5rem;
    font-style: italic;
    color: var(--text-body);
  }

  /* NEW: FAQ GROUP STYLES */
  .faq-group {
    margin-bottom: 2.5rem;
  }
  
  .faq-group-title {
    font-size: 1.2rem;
    color: var(--heading-color);
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--border-subtle);
  }

  details {
    margin-bottom: 0.5rem;
    background: linear-gradient(to right, var(--surface), transparent);
    border: 1px solid var(--border-subtle);
    border-radius: 4px;
    overflow: hidden;
  }

  summary {
    padding: rem;
    cursor: pointer;
    font-weight: 600;
    color: var(--text-body);
    transition: background-color 0.2s;
    list-style: none; /* Hide default arrow in some browsers */
  }

  summary::-webkit-details-marker {
    display: none;
  }

  summary:hover {
    background-color: var(--bg);
  }

  .faq-answer {
    padding: 1rem;
    padding-top: 0.5rem;
    line-height: 1.6;
    font-size: 0.95rem;
    
    /* CHANGED: Set answer text to accent color */
    color: var(--accent); 
    
    border-top: 1px solid var(--border-subtle);
  }
  
  /* Optional: If you have <p> tags inside, force them to inherit the color */
  .faq-answer p {
    margin: 0;
    color: inherit; 
  }

  /* =========================================
     AUTHOR CARD
     ========================================= */
  .author-section { margin-top: 4rem; margin-bottom: 3rem; }
  
  .unified-card {
    max-width: 800px;
    margin: 0 auto;
    background-color: var(--surface); 
    border: 1px solid var(--border-subtle);
    border-radius: 8px;
    padding: 2.5rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  }

  .unified-card h2 {
    margin-top: 0;
    margin-bottom: 2rem;
    font-size: 1.5rem;
    text-transform: uppercase;
    color: var(--text-muted);
    letter-spacing: 0.05em;
    border-bottom: 1px solid var(--border-subtle);
    padding-bottom: 0.5rem;
    display: inline-block;
  }

  .author-header-group {
    display: flex;
    flex-direction: row;
    align-items: center;
    text-align: left;
    margin-bottom: 2rem;
    gap: 1.5rem;
  }

  .author-photo-wrapper {
    width: 100px; 
    height: 100px;
    border-radius: 50%;
    overflow: hidden;
    border: 1px solid var(--border-subtle);
    padding: 3px;
    background: var(--bg);
    flex-shrink: 0;
  }
  
  .author-photo {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    filter: grayscale(100%);
  }

  .author-info-header {
    display: flex;
    flex-direction: column;
    justify-content: center;
    flex-grow: 1;
    position: relative;
  }

  .author-info-header::after {
    content: "";
    display: block;
    width: 100%;
    height: 1px;
    background: var(--border-subtle);
    margin-top: 0.5rem; 
    opacity: 0.6;
  }

  .scales-icon {
    position: absolute;
    right: 0;
    bottom: 8px; 
    width: 36px;
    height: 36px;
    color: var(--accent);
    opacity: 0.75;
    pointer-events: none;
  }

  .author-name {
    font-family: 'Montserrat', sans-serif;
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--heading-color);
    line-height: 1;
    margin-bottom: 0.25rem;
  }

  .author-credentials {
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--accent);
    font-weight: bold;
    opacity: 0.9;
  }

  .author-body-text {
    text-align: left; 
    font-size: 0.95rem; 
    line-height: 1.6;
    color: var(--text-body);
  }
  .author-body-text p { margin-bottom: 0.75rem; }

  .author-footer {
    margin-top: 2.5rem;
    padding-top: 2rem;
    border-top: 1px solid var(--border-subtle); 
    margin-left: -2.5rem; 
    margin-right: -2.5rem;
    margin-bottom: -2.5rem;
    padding-left: 2.5rem;
    padding-right: 2.5rem;
    padding-bottom: 2.5rem;
    background: rgba(var(--accent-rgb), 0.03); 
    border-radius: 0 0 8px 8px;
  }

  .author-footer h3 {
    margin-top: 0;
    color: var(--accent);
    font-size: 1.2rem;
    margin-bottom: 0.75rem;
  }

  .contact-list {
    padding-left: 1.2rem;
    margin: 1rem 0;
    color: var(--text-body);
  }
  
  .contact-list li { margin-bottom: 0.5rem; }

  .tag-code {
    background: var(--bg);
    border: 1px solid var(--border-subtle);
    padding: 0.2rem 0.4rem;
    border-radius: 4px;
    font-size: 0.85rem;
    font-family: monospace;
    color: var(--heading-color);
  }

  .contact-note {
    font-size: 0.9rem;
    color: var(--text-muted);
    margin-top: 1rem;
  }

  /* =========================================
     RESPONSIVE
     ========================================= */
  @media (max-width: 600px) {
    .doc-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
        padding: 1.25rem 0;
    }
    .doc-actions { width: 100%; justify-content: flex-start; }

    .author-header-group {
        flex-direction: column;
        align-items: center;
        text-align: center;
        gap: 1rem;
    }
    .author-info-header::after { display: none; }
    .scales-icon { display: none; }
    .unified-card { padding: 1.5rem; }
    
    .author-footer {
        margin-left: -1.5rem;
        margin-right: -1.5rem;
        margin-bottom: -1.5rem;
        padding: 1.5rem;
    }
  }
</style>